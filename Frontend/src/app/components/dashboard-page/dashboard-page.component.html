<div class="dashboard-layout">
  <app-header></app-header>
  <div class="dashboard-body">
    <app-aside></app-aside>
    <div class="publicaciones-container" *ngIf="publicaciones.length > 0; else sinPublicaciones">
      <div class="publicacion" *ngFor="let p of publicaciones" (click)="verDetalle(p.id)">
        <div class="autor" [routerLink]="['/usuario', p.autor_id]" (click)="irAlPerfil(p.autor_id)">
          <img [src]="'http://localhost:8080' + p.autor_foto" alt="Foto perfil" class="foto-perfil">
          <span class="nombre-autor">{{ p.autor_nombre }}</span>
        </div>
        <h3>{{ p.titulo }}</h3>
        <p>{{ p.descripcion }}</p>

        <div *ngIf="p.tipo_media === 'imagen' && p.media_url">
          <img [src]="getMediaUrl(p.media_url)" class="media" />
        </div>
        <div *ngIf="p.tipo_media === 'video' && p.media_url">
          <video class="media" controls (click)="$event.stopPropagation()">
            <source [src]="getMediaUrl(p.media_url)" type="video/mp4" />
          </video>
        </div>

        <div class="acciones" (click)="$event.stopPropagation()">
          <div class="grupo-izquierda">
            <button class="btn like" [class.liked]="p.liked">
              <i class="{{ p.liked ? 'fas' : 'far' }} fa-heart"></i>
              {{ p.likesCount || 0 }}
            </button>
            <button class="btn comentar" (click)="toggleFormularioComentario(p.id)">
              <i class="far fa-comment"></i>
            </button>
          </div>
          <div class="grupo-derecha">
            <button class="btn guardar" (click)="toggleGuardar(p)" [class.guardada]="p.guardada">
              <i class="{{ p.guardada ? 'fas' : 'far' }} fa-bookmark"></i>
            </button>

            <button
              *ngIf="p.autor_id === usuarioActualId"
              class="btn eliminar"
              (click)="eliminarPublicacion(p); $event.stopPropagation();">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        </div>

        <div *ngIf="publicacionComentandoId === p.id" class="formulario-comentario" (click)="$event.stopPropagation()">
          <textarea [(ngModel)]="nuevoComentario" placeholder="Escribe tu comentario..."></textarea>
          <button (click)="enviarComentario(p.id)">Enviar</button>
        </div>
      </div>
    </div>

    <div class="acciones-superiores">
      <button routerLink="/crear-publicacion" class="btn-crear-publicacion">
        Crear publicación
      </button>
    </div>

    <ng-template #sinPublicaciones>
      <p>No hay publicaciones aún.</p>
    </ng-template>
  </div>
</div>
